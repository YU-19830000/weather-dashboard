<script>
    const weatherCity = document.getElementById("weather_city");
    const weatherDesc = document.getElementById("weather_desc");
    const weatherTemp = document.getElementById("weather_temp");
  
    // Flaskから渡された初期値をJSに取り込む
    const defaultLat = {{ lat }};
    const defaultLon = {{ lon }};
  
    const map = L.map('map').setView([defaultLat, defaultLon], 10);
    const marker = L.marker([defaultLat, defaultLon]).addTo(map);
  
    // 地図タイル表示
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
  
    // 初期天気をHTMLに反映（Flaskでテンプレートに埋め込む）
    weatherCity.textContent = "都市：" + "{{ weather['city'] }}";
    weatherDesc.textContent = "天気：" + "{{ weather['description'] }}";
    weatherTemp.textContent = "気温：" + "{{ weather['temperature'] }} ℃";
  
    // 地図クリックで天気取得
    map.on('click', function(e) {
      const lat = e.latlng.lat;
      const lon = e.latlng.lng;
      fetch("/weather_by_coords", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ lat: lat, lon: lon })
      })
      .then(res => res.json())
      .then(data => {
        marker.setLatLng([lat, lon]);
        weatherCity.textContent = "都市：" + data.city;
        weatherDesc.textContent = "天気：" + data.description;
        weatherTemp.textContent = "気温：" + data.temperature + " ℃";
      });
    });
  </script>
  